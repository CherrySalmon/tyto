// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ruby
{
	"name": "TYTO Dev",
	// Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
	"image": "mcr.microsoft.com/devcontainers/ruby:1-3.4-bookworm",

	// Use host system timezone
	"containerEnv": {
		"TZ": "${localEnv:TZ}"
	},

	"features": {
		"ghcr.io/devcontainers/features/node:1": {
			"version": "22"
		},
		"ghcr.io/anthropics/devcontainer-features/claude-code:1": {},
		"ghcr.io/wxw-matt/devcontainer-features/script_runner:0": {},
		"ghcr.io/devcontainers/features/common-utils:2": {}
	},
	"customizations": {
		"vscode": {
			"extensions": [
				"vue.volar",
				"mhutchie.git-graph",
				"hediet.vscode-drawio"
			],
			"settings": {
				"rubyLsp.rubyVersionManager": {
					"identifier": "none"
				}
			}
		}
	},

	// Forward ports for frontend (8080) and backend (9292)
	"forwardPorts": [8080, 9292],

	// Run project setup after container is created (install libsodium first for rbnacl)
	"postCreateCommand": "sudo apt-get update && sudo apt-get install -y libsodium23 && bundle config set --local without production && bundle install && bundle exec rake setup"
}
